@startuml Health-KIU API Class Diagram
skinparam backgroundColor #ffffffff
skinparam classBackgroundColor #F8F9FA
skinparam classBorderColor #3b90dbff

package "Actores" {

    class Paciente {
        - id: int,
    }

    class Doctor {
        - id: int,
    }
    class Admin {
        - id: int,
    }
}

package "Servidor API" as ApiServer {
    package "Capa Presentación" as PresentationLayer {
        class Handlers {
            - appService: App
            + handleRequest(request: HttpRequest): HttpResponse
        }
    }
    note as PresentationLayerNote
    Maneja las solicitudes entrantes y las respuestas salientes.
    Representa una interfaz entre el cliente y la lógica de negocio.
    end note
    PresentationLayer .. PresentationLayerNote

    package "ServicesInterface" as Services {
        interface AuthService {
            + login(email: String, password: String): User
            + logout(userId: int): void
        }

        interface UserService {
            + consultarMedicosDisponiblesPorEspecialidad(Especialidad): List<Doctor>
            + listarDoctoresDisponibles(): List<Doctor>
            + listarEspecialidades(): List<Especialidad>
            + obtenerHistorialDeCita(Paciente): List<HistorialCita>
            + agendarCita(Paciente, Doctor, DateTime): Cita
            + verCitasProximas(Paciente): List<Cita>
            + cancelarCita(Cita): void
        }

        interface DoctorService {
            + verPacientesAsignados(Doctor): List<Paciente>
            + confirmarCita(Doctor, Cita): void
            + rechazarCita(Doctor,Cita): void
            + verAgenda(Doctor): Agenda
            + consultarDetalle(Doctor, Cita): DetalleCita
            + marcarHorasDisponibles(Doctor, List<DateTime>): void
        }

        interface AdminService {
            + verListaPacientes(Admin): List<Paciente>
            + verListaDoctores(Admin): List<Doctor>
            + verCitasDelSistema(Admin): List<Cita>
            + gestionarListaDeEspera(Admin): void
            + gestionarEspecialidades(Admin): void
            + gestionarMedicos(Admin): void
            + gestionarPacientes(Admin): void
        }
    }
    note as ServicesNote
    Abstrae los casos de uso de los handlers.
    Se diferencia de la capa de presentación en que **no requiere mantener paridad**
    estricta con el esquema de solicitud/respuesta HTTP.
    end note
    Services .up. ServicesNote

    package "Infraestructura" as Infra {
        class Database {
            + connect(): Connection
            + disconnect(): void
            + executeQuery(query: String): ResultSet
        }
    }

    package "Adaptadores" as Adapters {
        class DoctorServiceImpl {
            + db: Database
        }
        class UserServiceImpl {
            + db: Database
        }
        class AdminServiceImpl {
            + db: Database
        }
    }
    note as AdaptersNote
    Implementa las interfaces de los servicios utilizando la base de datos.
    Actúa como un puente entre la lógica de negocio y la capa de infraestructura.
    end note
    Adapters .. AdaptersNote

    Adapters.DoctorServiceImpl ..|> Services.DoctorService
    Adapters.DoctorServiceImpl --> Infra.Database
    Adapters.UserServiceImpl ..|> Services.UserService
    Adapters.UserServiceImpl --> Infra.Database
    Adapters.AdminServiceImpl ..|> Services.AdminService
    Adapters.AdminServiceImpl --> Infra.Database

    class "Aplicación" as App {
        - userService: impl UserService
        - doctorService: impl DoctorService
        - adminService: impl AdminService
        + processUserRequest(request): Response
        + processDoctorRequest(request): Response
        + processAdminRequest(request): Response
    }

    note as AppNote
    Orquesta la lógica de negocio coordinando
    entre los diferentes servicios del sistema.
    end note

    App .. AppNote
    App --> Adapters : <<uses>>

    PresentationLayer.Handlers --> App : <<calls>>

    ' AuthService inheritance - these should extend/implement AuthService
    Services.AuthService <|.. Services.DoctorService
    Services.AuthService <|.. Services.UserService
    Services.AuthService <|.. Services.AdminService



}

Actores.Paciente --> ApiServer.PresentationLayer.Handlers : <<interacts>>
Actores.Doctor --> ApiServer.PresentationLayer.Handlers : <<interacts>>
Actores.Admin --> ApiServer.PresentationLayer.Handlers : <<interacts>>
@enduml